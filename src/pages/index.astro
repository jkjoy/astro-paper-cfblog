---
import BaseLayout from '../layouts/BaseLayout.astro';
import PostCard from '../components/PostCard.astro';
import Pagination from '../components/Pagination.astro';
import { getPosts, PAGE_SIZE, getSiteInfo, getSettings, gravatarUrl } from '../lib/wp';

const current = 1;
const { posts, totalPages } = await getPosts(current, PAGE_SIZE);
const site = await getSiteInfo();
const settings = await getSettings();
const avatar = settings.admin_email ? await gravatarUrl(settings.admin_email, 160) : null;
---

<BaseLayout>
  {site && (site.name || site.description) ? (
    <div class="-mt-2 mb-12 flex items-center">
      {avatar && (
        <div class="h-24 w-24 shrink-0 rounded-full border-[0.5px] border-black/10 bg-white/50 p-3 ltr:mr-5 ltr:-ml-1 rtl:-mr-1 rtl:ml-5 dark:bg-white/90!">
          <img
            class="not-prose my-0 h-full w-full rounded-full bg-black/5! hover:animate-spin dark:bg-black/80!"
            src={avatar}
            alt={site?.name ?? 'CFBlog'}
          />
        </div>
      )}
      <div>
        <div class="mt-3 mb-1 text-2xl font-medium text-black dark:text-white">
          {site.name ?? 'CFBlog'}
        </div>
        {site.description && <div class="break-words">{site.description}</div>}
      </div>
    </div>
  ) : null}

  {posts.map((post) => (
    <PostCard post={post} />
  ))}

  <Pagination current={current} totalPages={totalPages} base="/page" />
</BaseLayout>

